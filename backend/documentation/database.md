# Database Reference

We host our database using [supabase](https://supabase.com/). Here is documentation for all the tables and an sql command to quickly setup your own supabase instance.

<!-- Everything below this title is generated by `generate_docs.py` and it will delete anything written by a user -->
<!-- If you changed anything in the database, please re-run the script (from the backend/ dir) and commit this file -->
## Tables

### `inactive_buy_sell`
Where expired and fulfilled orders go
| Columns       | Type                        | Description               |
| ------------- | --------------------------- | ------------------------- |
| delisted_time | timestamp without time zone |                           |
| userId        | uuid                        | **FK(`profiles.userId`)** |
| buy_or_sell   | boolean                     | true = buy, false = sell  |
| time_posted   | timestamp without time zone |                           |
| price         | bigint                      |                           |
| expirey       | timestamp without time zone |                           |
| quantity      | bigint                      |                           |
| completed     | boolean                     |                           |
| stockId       | bigint                      | **FK(`stock_info.id`)**   |
| Id            | bigint                      | **PK**                    |
| orderId       | uuid                        |                           |

### `portfolio`
A table of all the stocks that all the users own
| Columns   | Type             | Description                             |
| --------- | ---------------- | --------------------------------------- |
| stockId   | bigint           | **FK(`stock_info.id`)**                 |
| quantity  | bigint           |                                         |
| userId    | uuid             | **FK(`profiles.userId`)**               |
| price_avg | double precision | The price at which the stock was bought |

### `stock_price_history_daily`
Tracks all stock price changes in real time
| Columns    | Type                        | Description             |
| ---------- | --------------------------- | ----------------------- |
| id         | bigint                      | **PK**                  |
| changed_at | timestamp without time zone |                         |
| price      | bigint                      |                         |
| stockId    | bigint                      | **FK(`stock_info.id`)** |

### `active_buy_sell`
Table with all the currently tradable orders
| Columns            | Type                        | Description               |
| ------------------ | --------------------------- | ------------------------- |
| time_posted        | timestamp without time zone |                           |
| buy_or_sell        | boolean                     | true = buy, false = sell  |
| price              | bigint                      |                           |
| expirey            | timestamp without time zone |                           |
| quantity           | bigint                      |                           |
| stockId            | bigint                      | **FK(`stock_info.id`)**   |
| userId             | uuid                        | **FK(`profiles.userId`)** |
| Id                 | bigint                      | **PK**                    |
| orderId            | uuid                        |                           |
| has_been_processed | boolean                     |                           |

### `stock_price_history_monthly`
Stores past data over 1 day blocks
| Columns         | Type                        | Description             |
| --------------- | --------------------------- | ----------------------- |
| id              | bigint                      | **PK**                  |
| starting_hour   | timestamp without time zone |                         |
| stockId         | bigint                      | **FK(`stock_info.id`)** |
| average_price   | double precision            |                         |
| highest_price   | bigint                      |                         |
| lowest_price    | bigint                      |                         |
| opening_price   | bigint                      |                         |
| closing_price   | bigint                      |                         |
| volume_of_sales | bigint                      |                         |

### `stock_price_history_weekly`
Hourly stock prices - only kept for 7 days and then cut off
| Columns         | Type                        | Description             |
| --------------- | --------------------------- | ----------------------- |
| id              | bigint                      | **PK**                  |
| starting_hour   | timestamp without time zone |                         |
| stockId         | bigint                      | **FK(`stock_info.id`)** |
| average_price   | double precision            |                         |
| highest_price   | bigint                      |                         |
| lowest_price    | bigint                      |                         |
| opening_price   | bigint                      |                         |
| closing_price   | bigint                      |                         |
| volume_of_sales | bigint                      |                         |

### `flags`
User flags such as achievements or badges
| Columns     | Type   | Description |
| ----------- | ------ | ----------- |
| id          | bigint | **PK**      |
| name        | text   |             |
| description | text   |             |
| image       | text   |             |
| type        | text   |             |

### `profiles`
Information about user profiles
| Columns   | Type                     | Description             |
| --------- | ------------------------ | ----------------------- |
| joined_at | timestamp with time zone |                         |
| username  | text                     |                         |
| balance   | bigint                   |                         |
| networth  | bigint                   |                         |
| comments  | text[]                   | Comments about the user |
| userId    | uuid                     | **PK**                  |
| image     | text                     |                         |

### `stock_info`
General information about stocks. For price, check `stock_price`
| Columns       | Type   | Description |
| ------------- | ------ | ----------- |
| id            | bigint | **PK**      |
| name          | text   |             |
| description   | text   |             |
| image         | text   |             |
| total_shares  | bigint |             |
| ticker_symbol | text   |             |

### `market_State`
All the times the market has open and closed
| Columns      | Type                        | Description   |
| ------------ | --------------------------- | ------------- |
| id           | bigint                      | **PK**        |
| changed_last | timestamp without time zone |               |
| state        | boolean                     | true = active |

### `stock_price`

| Columns     | Type   | Description |
| ----------- | ------ | ----------- |
| stockId     | bigint | **PK**      |
| stock_price | bigint |             |

### `rel_user_flag`
Which users have what flags
| Columns | Type   | Description               |
| ------- | ------ | ------------------------- |
| flagId  | bigint | **FK(`flags.id`)**        |
| userId  | uuid   | **FK(`profiles.userId`)** |

### `contributors`
Data about people who have contributed to the project
| Columns         | Type   | Description                              |
| --------------- | ------ | ---------------------------------------- |
| id              | bigint | **PK**                                   |
| name            | text   |                                          |
| description     | text   | Description for the "meet the team" page |
| image           | text   |                                          |
| role            | text   | Role for the "meet the team" page        |
| twitterUsername | text   |                                          |
| discordUserID   | text   |                                          |
| githubUsername  | text   |                                          |

### `rewards_logging`
logging daily and all other rewards for a user
| Columns       | Type                        | Description               |
| ------------- | --------------------------- | ------------------------- |
| id            | bigint                      | **PK**                    |
| user_id       | uuid                        | **FK(`profiles.userId`)** |
| stock_id      | bigint                      | **FK(`stock_info.id`)**   |
| quantity      | bigint                      |                           |
| dollar_amount | bigint                      |                           |
| created_at    | timestamp without time zone |                           |
| reason        | text                        |                           |

